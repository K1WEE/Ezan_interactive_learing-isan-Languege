{% extends "base.html" %} 
{% load static %}  

{% block extra_css %} 
<link href="https://unpkg.com/boxicons@2.1.1/css/boxicons.min.css" rel="stylesheet"> 
<link href="{% static "css/profile.css" %}" rel="stylesheet"> 
{% endblock extra_css %}  

{% block title %}EZan - My Profile{% endblock title %}  

{% block content %} 
<!-- Sidebar --> 
<nav class="sidebar close">     
    <header>         
        <div class="image-text">             
            <span class="image">                 
                <img src="/static/images/logo2.png" alt="logo">             
            </span>              
            <div class="text header-text">                 
                <span class="username">{{user.first_name}}</span>             
            </div>         
        </div>          
        <i class="bx bx-chevron-right toggle"></i>     
    </header>      
    <div class="menu-bar">         
        <div class="menu">             
            <li class="nav-link">                 
                <a href="{% url "home" %}">                     
                    <i class="bx bx-home-alt icon"></i>                     
                    <span class="text nav-text">HOME</span>                 
                </a>             
            </li>              
            <li class="nav-link">                 
                <a href="{% url "learn" %}">                     
                    <i class="bx bx-book icon"></i>                     
                    <span class="text nav-text">LEARN</span>                 
                </a>             
            </li>              
            <li class="nav-link">                 
                <a href="{% url "profile" %}" class="active">                     
                    <i class="bx bx-user icon"></i>                     
                    <span class="text nav-text">PROFILE</span>                 
                </a>             
            </li>              
            <li class="nav-link">                 
                <a href="{% url "logout" %}">                     
                    <i class="bx bx-log-out icon"></i>                     
                    <span class="text nav-text">LOG OUT</span>                 
                </a>             
            </li>         
        </div>     
    </div> 
</nav>  

<!-- Main Content --> 
<section class="main-content">
    {% if messages %}
    <div class="messages">
        {% for message in messages %}
        <div class="alert {% if message.tags %}alert-{{ message.tags }}{% endif %}">
            {{ message }}
        </div>
        {% endfor %}
    </div>
    {% endif %}
    
    {% if show_done %}
    <script>
        // This will trigger the done animation on page load if needed
        document.addEventListener('DOMContentLoaded', function() {
            setTimeout(function() {
                showDoneMessage('Profile successfully updated!');
            }, 500);
        });
    </script>
    {% endif %}
     
    <div class="profile-header">         
        <h1 class="profile-title">MY PROFILE</h1>     
    </div>      
    
    <div class="profile-card">         
        <div class="profile-card-header">             
            <div class="profile-avatar">                 
                <img src="/static/images/nok_yay.png" alt="Profile" id="profileAvatar">             
            </div>             
            <h2 class="profile-name" id="username">
                {% if user.first_name %}
                    {{user.first_name}}
                {% else %}
                    Nonamed
                {% endif %}
            </h2>         
        </div>          
        
        <form method="POST" class="profile-info">
            {% csrf_token %}
            <div class="info-section">                 
                <h3>Account Information</h3>                  
                
                <div class="info-field">                     
                    <label>Name</label>                     
                    <div class="field-content">                         
                        <span id="nameValue">
                            {% if user.first_name %}
                    {{user.first_name}}
                {% else %}
                    Nonamed
                {% endif %}
                        </span>
                        <button type="button" class="edit-btn" data-field="first_name">Edit</button>
                        <div class="edit-form" id="firstNameForm" style="display: none;">
                            {{ user_form.first_name }}
                            <div class="form-error" id="firstNameError"></div>
                        </div>
                    </div>                  
                </div>                  
                
                <div class="info-field">                     
                    <label>Email</label>                     
                    <div class="field-content">                         
                        <span id="emailValue">{{user.email}}</span>
                        <button type="button" class="edit-btn" data-field="email">Edit</button>
                        <div class="edit-form" id="emailForm" style="display: none;">
                            {{ user_form.email }}
                            <div class="form-error" id="emailError"></div>
                        </div>
                    </div>                 
                </div>                  
                
                <div class="info-field">                     
                    <label>Password</label>                     
                    <div class="field-content">                         
                        <span id="passwordValue">•••••••••••••</span>
                        <button type="button" class="edit-btn" data-field="password">Edit</button>
                    </div>                 
                </div>             
            </div>
            
            <div class="profile-actions">             
                <button type="submit" id="saveChangesBtn" class="btn btn-primary" disabled>Save Changes</button>             
                <button type="button" id="cancelBtn" class="btn btn-secondary" disabled>Cancel</button>         
            </div>
        </form>
        
        <!-- Password Change Modal -->
        <div id="passwordModal" class="modal" style="display: none;">
            <div class="modal-content">
                <span class="modal-close">&times;</span>
                <h3>Change Password</h3>
                <form id="passwordForm" method="POST" action="{% url 'change_password' %}">
                    {% csrf_token %}
                    <div class="form-group">
                        <label for="id_old_password">Current Password</label>
                        {{ password_form.old_password }}
                        <div class="form-error" id="oldPasswordError"></div>
                    </div>
                    <div class="form-group">
                        <label for="id_new_password1">New Password</label>
                        {{ password_form.new_password1 }}
                        <div class="form-error" id="newPassword1Error"></div>
                    </div>
                    <div class="form-group">
                        <label for="id_new_password2">Confirm New Password</label>
                        {{ password_form.new_password2 }}
                        <div class="form-error" id="newPassword2Error"></div>
                    </div>
                    <div class="modal-actions">
                        <button type="submit" class="btn btn-primary">Update Password</button>
                        <button type="button" class="btn btn-secondary" id="cancelPassword">Cancel</button>
                    </div>
                </form>
            </div>
        </div>
    </div>  
</section>  
{% endblock content %}  

{% block extra_js %} 
<script src="{% static 'js/profile.js' %}"></script> 
{% endblock extra_js %}